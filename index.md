# [Nimの基本](https://narimiran.github.io/nim-basics/)

Nimは、比較的新しいプログラミング言語で、読みやすく高性能なコードが書けます。ですが、Nimのチュートリアルを読んでいれば、おそらくNimについて既にご存知でしょう。

チュートリアルは [オンライン](https://narimiran.github.io/nim-basics/) もしくは [PDF](https://github.com/narimiran/nim-basics/raw/master/nim-basics.pdf) よりご覧いただけます。

なお、このドキュメントは未完成です。エラーが見つかったりこのドキュメントに改善点があれば、[issue tracker](https://github.com/narimiran/nim-basics/issues) までご連絡ください。

## 対象となる読者

* プログラミング経験がない、もしくは、乏しい方。
* 他のプログラミング言語の経験がある方。
* 1からNimを詳しく知りたい方。

## 対象とならない読者
* プログラミング経験豊富な方。より高度なチュートリアルの方が適しているでしょう。[チュートリアル](https://nim-lang.org/docs/tut1.html) または [Nim by Example](https://nim-by-example.github.io/) をご覧ください。
* Nimの経験がある方。(ドキュメントの改善にご協力ください)

## 本チュートリアルの使い方
本チュートリアルの目的は、プログラミングの基本およびNimの構文をお伝えすることです。そのため他のチュートリアルより簡単で、より深く追求できるようになります。

読むだけではなく、実行したり、例文を改造したり、自分で例文を考えたり、全体的に興味をもつとベストです。各章の終わりの演習問題は飛ばしてはいけません。交渉の余地なしです。

本チュートリアルの内容以上のことを知りたい場合、[Nimフォーラム](https://forum.nim-lang.org/)、[Nim Gitter channel](https://gitter.im/nim-lang/Nim)、[Discord Server](https://discordapp.com/invite/ezDFDw2)、NimのフリーノードIRCチャンネル(#nim)で質問してみてください。

## インストール
### Nimのインストール
Nimは主要3オペレーティングシステム向けにパッケージを提供しており、インストールに関しては複数のオプションがあります。

[公式インストール手順](https://nim-lang.org/install.html)に従って最新の安定版をインストールできます。また、最新の機能やバグ修正に興味がありましたら、最新の開発バージョンと安定版を簡単に切り替えられる[choosenim](https://github.com/dom96/choosenim)というツールを使うこともできます。

どちらにせよ、リンク先のインストール手順に従ってNimをインストールしてください。以下の章で、インストールがうまくいったか確認します。

Linuxをお使いであれば、高確率でディストリビューションのパッケージ・マネージャにNimが入っているはずです。この方法でインストールを行った場合は、最新バージョン（webサイトから確認してください）かどうか確認してください。それ以外の方法でインストールする場合は、上述の手順に従ってください。

本チュートリアルでは、現時点の安定版 Nim 0.19を使用します。

### Additional Toolsのインストール
任意のテキストエディタでNimのコードを記述し、ターミナルからコンパイルして実行できます。シンタックスハイライトや補完機能をお望みであれば、人気のエディタにはプラグインがあり、これらの機能が提供されています。

シンタックスハイライトと補完が使える[Nim Extension](https://marketplace.visualstudio.com/items?itemName=kosz78.nim)と、すぐにコンパイルと実行ができる[Code Runner Extension](https://marketplace.visualstudio.com/items?itemName=formulahendry.code-runner)を入れた[VS Code](https://code.visualstudio.com/)が筆者のお気に入りです。

他のエディターをお使いであれば、エディタのサポートについて[Wiki](https://github.com/nim-lang/Nim/wiki/Editor-Support)をご覧ください。

### インストールのテスト
インストールが成功したかどうか確認するため、入門の例題としてお決まりの[Hello World](https://en.wikipedia.org/wiki/%22Hello,_World!%22_program)を書いてみます。Nimでは、Hello World! の出力（プリンタで印刷するのではなく、画面上に表示）は簡潔で、おまじないも不要です。

`helloworld.nim` 等の新規ファイルに、下記の一行を書くだけです。

```helloworld.nim
echo "Hello World!"
```

*※出力したい文言は、`echo`コマンドの後ろに記述し、二重引用符（"）で囲む必要があります。*

まず、プログラムをコンパイルし、実行して期待通りの結果が得られるか見てみます。

ファイルがあるディレクトリ（Linuxの場合、ファイルマネージャを開いてディレクトリを右クリックし、「端末を開く」。Windowsの場合は、Shift + 右クリックして「コマンド ウィンドをここで開く」）

コンパイルするにはターミナル上で以下を入力します。

```Nim
nim c helloworld.nim
```

コンパイルが終了したら、プログラムが実行できるようになります。Linuxではターミナルから`./helloworld`と入力し、Windowsでは`helloworld.exe`と入力すれば実行できます。

1コマンドでコンパイルと実行を両方実行できます。以下を入力します。

```Nim
nim c -r helloworld.nim
```

*`c`オプションでコンパイル、`-r`オプションで即時実行。すべてのオプションを表示するにはターミナル上で`nim --help`と入力します。*

前述のCode Runnerを入れたVS Codeをご利用の場合は、`Ctrl+Alt+N`を入力すればコンパイルと実行が行われます。

いずれの方法で実行しても、すぐにウィンドウ（またはターミナル）に下記が表示されます。

```Nim
Hello World!
```

おめでとうございます！ はじめてののNimプログラムが正常に動作しました。

さて、これで画面上に何らかの文字を（`echo`コマンドを使用して）表示して、（ターミナル上で`nim c programName.nim`を入力して）コンパイルして、（様々な可能性のある）プログラムを実行する手段を知りました。

単純なNimプログラムを書くのに役立つ基本的な要素を追求し始めることができるようになりました。

## 命名の価値
プログラムの名前を大事にすると物事を追うのに役立ちます。ユーザに名前を尋ねるとして、後で使用するために保存しておきたいのです。それも、処理の度に何度も何度も尋ねないで、です。

`pi = 3.14`という例では、名前`pi`は値`3.14`と結びついています。経験上、変数`pi`は（10進）数だと言えます。

`firstName = Alice`という例では、`firstName`は`Alice`という値を持つ変数名です。この変数の型は語だと言えるでしょう。

プログラミング言語でも同様です。これらの代入は、*名前*、*値*、*型*を持ちます。

### 変数宣言
Nimは[静的型付け](https://en.wikipedia.org/wiki/Type_system#STATIC)プログラミング言語です。つまり、値を使用する前に代入の型を宣言する必要があります。

Nimでは、変更できる値とできない値を区別しますが、後ほど詳しく説明します。`var`キーワードを使用して変数（変更可能な代入）を宣言できます。下記構文を使用して名前と型を記述（値は後で追加できます）するだけです。

```Nim
var <名前>: <型>
```

あらかじめ値がわかっていれば、変数宣言の直後に値を渡せます。

```Nim
var <名前>: <型> = <値>
```

*山かっこ（`<>`）は変更可能であることを示すために使用しています。そのため、`<名前>`は、山かっこで囲まれた文字通りの単語ではなく、任意の名前です。*

Nimは[型推論](https://en.wikipedia.org/wiki/Type_inference)もあり、コンパイラは、型を明示的に指定しなくても、代入文の値から型を検出できます。次の章では、様々な変数の型を説明します。

以下のように、明示的な型を指定しなくても変数に代入できます。

```Nim
var <名前> = <値>
```

この例は下記のようになります。

```Nim
var a: int  [1]
var b = 7   [2]
```

* [1] 変数`a`はint（整数）型で、値は明示的に指定されていません。
* [2] 変数`b`の値は`7`です。型は自動的に整数として検出されます。

代入の際はプログラムにとって意味のある名前を選ぶことが重要です。単純に`a`、`b`、`c`といった具合に命名するとすぐに混乱するでしょう。名前にスペースを使用することはできません。名前が二つに分割されるためです。選択した名前が二つ以上の単語で構成されている場合、通常キャメルケース `camelCase` で記述します。（最初の文字は小文字である必要があります）

しかし、Nimは大文字と小文字を区別しないため、`helloWorld`と`hello_world`は同じ意味になります。これに対する例外は、大文字と小文字が区別される最初の文字です。名前には、数字、他のUTF-8の文字、もしお望みならば絵文字を含めることができますが、自分や他の人も入力しなければならないことに注意してください。

変数ごとに`var`と入力する代わりに、同じ`var`ブロック内で複数の変数（必ずしも同じ型である必要はありません）を宣言できます。Nimでは、ブロックは同じインデント（最初の文字の前にある同じ数のスペース）を持つコードの一部であり、デフォルトのインデントレベルはスペース2つです。このようなブロックは、代入部分に限ったことではなく、Nimプログラムのいたるところにがあります。 

```
var
  c = -11
  d = "Hello"
  e = '!'
```

*Nimでは、インデントに`Tab`を使用することはできません。`Tab`を任意の数のスペースに置き換えるようエディタを設定できます。VS Codeのデフォルト設定では、`Tab`から4つのスペースへの変換です。設定（`Ctrl+,`）から `"editor.tabSize": 2`を設定することでで簡単に上書きされます。*

前述のとおり変数は変更可能です。つまり、値は（複数回）変更される可能性がありますが、型は宣言時と同じものでなくてはなりません。

```Nim
var f = 7               [1]

f = -3                  [2]
f = 19
f = "Hello" # error     [3] [4]
```

* [1] 変数`f`の初期値は`7`で、`int`型とみなされます。
* [2] `f`の値はまず`-3`に変更され、次に`19`に変更されます。これらは両方とも整数で、元の値と同じです。
* [3] `Hello`は数値ではないため、`f`の値を `"Hello"` に変更しようとするとエラーとなり、`f`の型は整数から文字列に変更されます。
* [4] `＃エラー`はコメントです。コード中のコメントは`#`の後に記述します。以降、行内の記述はすべて無視されます。

### 不変代入
`var`キーワードで宣言された変数とは別に、Nimにはさらに2種類の代入が存在します。それらの値は変更できません。1つは`const`キーワードで宣言され、もう1つは`let`キーワードで宣言されます。

#### Const
`const`キーワードを使用して宣言された不変代入の値は、コンパイル時（プログラムの実行前）にわかっていなければなりません。

例えば、重力加速度を `const g = 9.81`、円周率を `const pi = 3.14` と宣言すると、これらの値はあらかじめわかっているためプログラムの実行中に変わることはありません。

```Nim
const g = 35
g = -27         # error [1]

var h = -5
const i = h + 7 # error [2]
```

* [1] 定数の値は変更できません。
* [2] 変数`h`はコンパイル時には評価されません（変数であり、値がプログラムの実行中に変わる可能性があります）。その結果、定数`i`の値はコンパイル時にはわからず、エラーになります。

プログラミング言語によっては、定数の名前を大文字で書くのが一般的な方法ですが、Nimの定数は他の変数と同じように記述します。

#### Let
`let`で宣言された不変代入はコンパイル時にわかっている必要はなく、値はプログラムの実行中いつでも設定できますが、一度設定すると変更できません。

```Nim
let j = 35
j = -27 # error [1]

var k = -5
let l = k + 7   [2]
```

* [1] 不変値は変更できません。
* [2] 前述の`const`の例とは違って、こちらは動作します。

実際は`const`より`let`のほうが頻繁に現れたり使用することになるでしょう。

いかなる場合でも`var`は使用できますが、基本的には`let`を使用すべきです。値を変更する場合のみ変数に`var`を使用してください。


## 基本的なデータ型

### 整数
前章で見たように、整数とは小数部と小数点なしで記述された数値です。

例えば、`32`、`-174`、`0`、`10_000_000`はすべて整数です。大きな数を読みやすくするため、千単位の区切り記号に`_`を使用できます（`10000000`ではなく`10_000_000`と表記すれば、1千万のことだとわかりやすくなります）。

通常の算術演算子、加算(`+`)、減算(`-`)、乗算(`*`)、除算(`/`)、は期待通り動作します。最初の3つの演算は常に整数を生成しますが、2つの整数を除算する場合は、余りがでなくても、結果は常に浮動小数点数（小数点がある値）となります。

整数の除算（小数点切り捨て）は`div`演算子で実現できます。整数の除算による剰余（法）に興味があれば`mod`演算子を使用します。この2つの演算結果は常に整数値となります。

```integers.nim
let
  a = 11
  b = 4

echo "a + b = ", a + b      [1]
echo "a - b = ", a - b
echo "a * b = ", a * b
echo "a / b = ", a / b
echo "a div b = ", a div b
echo "a mod b = ", a mod b
```

* [1] `echo`コマンドは、コンマ区切りの文字をすべて画面に出力します。ここでは、最初に文字列 `a + b = ` を出力し、同じ行に式 `a + b` の結果を出力します。

上記をコンパイルして実行すると、次のように出力されます。

```Nim
a + b = 15
a - b = 7
a * b = 44
a / b = 2.75
a div b = 2
a mod b = 3
```

### 小数
浮動小数点数は、実数の[近似表現](https://en.wikipedia.org/wiki/Floating-point_arithmetic)です。

例えば、`2.73`、`-3.14`、`5.0`、`4e7`は浮動小数点数です。`e`の後が指数になるような大きな浮動小数点数には科学的表記法を使用できます。この例では、`4e7`は`4 * 10 ^ 7`を表します。 

```floats.nim
let
  c = 6.75
  d = 2.25

echo "c + d = ", c + d
echo "c - d = ", c - d
echo "c * d = ", c * d
echo "c / d = ", c / d
```

```Nim
c + d = 9.0         [1]
c - d = 4.5
c * d = 15.1875
c / d = 3.0         [1]
```

* [1] 加算と除算の例では、小数部分がなくなっても、結果はまだ浮動小数点型であることに注意してください。

算術演算の優先順位はご想像どおりで、乗算と除算は加算と減算よりも優先されます。

```Nim
echo 2 + 3 * 4
echo 24 - 8 / 4
```

```Nim
14
22.0
```

#### 浮動小数点数と整数の変換

Nimでは、型が異なる変数の算術演算は行えません。エラーとなります。

```Nim
let
  e = 5
  f = 23.456

echo e + f   # error
```

変数の値は同じ型に変換する必要があります。変換は用意で、整数への変換は`int`関数を、浮動小数点数への変換はf`loat`関数を使用します。

```Nim
let
  e = 5
  f = 23.987

echo float(e)      [1]
echo int(f)        [2]

echo float(e) + f  [3]
echo e + int(f)    [4]
```

* [1] 整数`e`を浮動小数点数にしたものを出力します。 （`e`は整数型のままです）
* [2] 浮動小数点数`f`を`int`型にしたものを出力します。
* [3] どちらのオペランドも浮動小数点数であり、加算できます。
* [4] どちらのオペランドも整数であり、加算できます。

```Nim
5.0
23
28.987
28
```

*`int`関数を使用して浮動小数点数を整数に変換すると丸められません。小数点以下が切り捨てられます。
丸めるには別の関数を呼び出す必要がありますが、そのためにはNimの使い方についてもう少し詳しく知っておく必要があります。*

### 文字
`char`型はASCII文字一文字を表すために使用します。

文字は2つの単一引用符（`'`）の間に記述します。使用できるのは、文字、記号、1桁の数字です。複数桁の数字や文字があるとエラーになります。

```Nim
let
  h = 'z'
  i = '+'
  j = '2'
  k = '35' # error
  l = 'xy' # error
```

### 文字列
文字列は連続した文字の表現に使用します。2つの二重引用符 (`"`) の間に記述します。

文字列を単語と考えることもできますが、複数の単語、記号、数字を含めることができます。

```strings.nim
let
  m = "word"
  n = "A sentence with interpunction."
  o = ""    [1]
  p = "32"  [2]
  q = "!"   [3] 
```

* [1] 空文字
* [2] (`int`型の) 数値ではありません。二重引用符に囲まれており、文字列となります。
* [3] 一文字ですが、二重引用符に囲まれているため単一の文字ではありません。

#### 特殊な文字
下記文字列を出力しようとすると、

```Nim
echo "some\nim\tips"
```

こうなって驚くかもしれません。

```Nim
some
im	ips
```

これは、特殊な意味を持つ文字があるためです。文字の前にエスケープ文字 `\` をつけて使用します。

* `\n` は改行文字です。
* `\t` はタブ文字です。
* `\\` はバックスラッシュです（`\` がエスケープ文字として使用されるため）。

上記の例を書いたとおりに出力したい場合、2通りあります。

* バックスラッシュを出力するには、`\` の代わりに `\\` を使用します。
* 構文 `r"…​"`（最初の引用符の直前に文字 `r` を入れる）を使用して文字列をそのまま入力します。この構文内では、エスケープ文字に特別な意味はありません。すべてそのまま出力されます。

```Nim
echo "some\\nim\\tips"
echo r"some\nim\tips"
```

```Nim
some\nim\tips
some\nim\tips
```

特殊文字は上記に限りません。なお、[Nimのマニュアル](https://nim-lang.org/docs/manual.html#lexical-analysis-string-literals)内にすべて記述されています。

#### 文字列の連結
Nimの文字列は可変です。つまり、内容が変わる可能性があります。`add`関数を使うと、既存の文字列に別の文字列か単一の文字を追加できます。元の文字列を変更したくない場合は、`&` 演算子を使用して文字列を連結（結合）することもできます。これにより、新しい文字列が返されます。

```stringConcat.nim
var                     [1]
  p = "abc"
  q = "xy"
  r = 'z'

p.add("def")            [2]
echo "p is now: ", p

q.add(r)                [3]
echo "q is now: ", q

echo "concat: ", p & q  [4]

echo "p is still: ", p
echo "q is still: ", q
```

* [1] 文字列を変更するつもりであれば、`var` で宣言しなければなりません。
* [2] 別の文字列を追加すると、既存の文字列 `p` がその場で変更されます。
* [3] 文字列に単一の文字を追加することもできます。
* [4] 2つの文字列を連結すると、元の文字列を変更せずに新しい文字列が生成されます。

```Nim
p is now: abcdef
q is now: xyz
concat: abcdefxyz
p is still: abcdef
q is still: xyz
```

### ブーリアン
ブーリアン（または単にブール）型は、`true` か `false` の2つの値しかありません。ブーリアンは通常、関係演算子の結果で、制御構文（次章）に使用されます。

ブーリアン変数の命名規則は、通常、単純なイエス・ノー（true・false）で答えられるものです。例えば、`isEmpty`、`isFinished`、`isMoving`などです。

#### 関係演算子
関係演算子は、比較可能なエンティティの関係を評価します。

2つの値が同じかどうかを比較するには、`==`（等号2つ）を使用します。`=` と混同しないでください。こちらは、前述したように代入に使用します。

整数に関わる、定義済み関係演算子は以下のとおりです。

```relationalOperators.nim
let
  g = 31
  h = 99

echo "g は h より大きい: ", g > h
echo "g は h より小さい: ", g < h
echo "g は h と等しい: ", g == h
echo "g は h と等しくない: ", g != h
echo "g は h 以上: ", g >= h
echo "g は h 以下: ", g <= h
```

```Nim
g は h より大きい: false
g は h より小さい: true
g は h と等しい: false
g は h と等しくない: true
g は h 以上: false
g は h 以下: true
```

単一の文字や文字列を比較することもできます。

```relationalOperators.nim
let
  i = 'a'
  j = 'd'
  k = 'Z'

echo i < j
echo i < k  [1]

let
  m = "axyb"
  n = "axyz"
  o = "ba"
  p = "ba "

echo m < n  [2]
echo n < o  [3]
echo o < p  [4]
```

* [1] 大文字は小文字の前に来ます。
* [2] 文字列比較は文字ごとに行われます。最初の3文字は同じで、文字`b`は文字`z`よりも小さいです。
* [3] 同一かどうかの比較でなければ、文字列の長さは関係ありません。
* [4] 短い文字列は長い文字列よりも小さくなります。

```Nim
true
false
true
true
true
```

#### 論理演算子
論理演算子は、1つ以上のブーリアン値から構成される式の真偽を評価するのに使用します。

* 論理積 (`and`) は、両方のメンバが `true` の場合にのみ `true` を返します。
* 論理和 (`or`) は、メンバのうち少なくとも１つが `true` の場合に `true` を返します。
* 排他的論理和 (`xor`) は、片方が `true` で、もう片方が `true` でない場合に `true` を返します。
* 論理否定 (`not`) は、メンバの真偽値を反転します。`true` を `false` へ、そして逆も同様です（被演算子を1つしか取らない唯一の論理演算子です）。

```logicalOperators.nim
echo "T and T: ", true and true
echo "T and F: ", true and false
echo "F and F: ", false and false
echo "---"
echo "T or T: ", true or true
echo "T or F: ", true or false
echo "F or F: ", false or false
echo "---"
echo "T xor T: ", true xor true
echo "T xor F: ", true xor false
echo "F xor F: ", false xor false
echo "---"
echo "not T: ", not true
echo "not F: ", not false
```

```Nim
T and T: true
T and F: false
F and F: false
---
T or T: true
T or F: true
F or F: false
---
T xor T: false
T xor F: true
F xor F: false
---
not T: false
not F: true
```

関係演算子と論理演算子を組み合わせて、より複雑な式をつくることができます。

例えば、`(5 < 7) and (11 + 9 == 32 - 2*6)` は `true and (20 == 20)` になり、さらに `true and true` になり、最終的に `true` が得られます。

### まとめ
本章はこのチュートリアルで最も長い章で、多岐にわたりました。時間をとって各データ型を調べ、それぞれのデータ型で何ができるか試してみてみてください。

型は最初は拘束されたかのように思えるかもしれません。しかし、Nimコンパイラによるコードの高速化と、意図しない不具合を起こさないようにできます。

さて、これで基本的なデータ型と演算方法がわかりました。Nimで簡単な処理をするのに十分なはずです。以下の演習をしてテストしてみてください。

### 演習
1. あなたの年齢を設定した不変変数を作成してください。作成したら年齢を日数で出力してください。（1年365日）
1. あなたの年齢が3で割り切れるかどうか確認してください。（ヒント：`mod`を使ってください）
1. あなたの身長をセンチメートルで設定した不変変数を作成してください。作成したら身長をインチで出力してください。（1インチ = 2.54 cm）
1. パイプの直径は3/8インチです。直径をセンチメートルで表現してください。
1. あなたの姓を設定した不変変数と、名を設定した別の変数を作成してください。前の2つの変数を連結して、変数 `fullName` を作成してください。間に空白を入れるのを忘れないでください。そしてフルネームを出力してください。
1. アリスは15日ごとに400ドルを稼ぎます。ボブは1時間あたり3.14ドルを稼ぎ、1日8時間、週7日働いています。30日後、アリスの収入はボブ以上ですか？ （ヒント：関係演算子を使う）



---

## 注意
* 本ページは、Nimのドキュメントページを個人が翻訳したものです。
* 読みやすさを優先するため、一部意訳している箇所があります。
* 誤訳等による不利益等、いかなる場合においても責任は負いかねます。
